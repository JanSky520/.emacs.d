#+title:   elisp 配置文件
#+author:  JanSky
#+date:    2025-07-10
#+STARTUP: overview indent


* 基础配置
#+begin_src emacs-lisp
  (setq inhibit-startup-screen t)                      ;; 关闭开始界面
  (global-display-line-numbers-mode 1)                 ;; 显示行号
  (setq display-line-numbers-width-start t)            ;; 动态调整行号宽度
  (setq display-line-numbers-grow-only t)              ;; 行号宽度只增不减（减少抖动）
  (tool-bar-mode -1)                                   ;; 关闭工具栏
  (menu-bar-mode -1)                                   ;; 关闭菜单栏
  (setq-default cursor-type 'bar)                      ;; 更改光标样式
  (global-hl-line-mode t)                              ;; 高亮当前行
  (scroll-bar-mode -1)                                 ;; 关闭文件滑动控件
  (show-paren-mode t)                                  ;; 括号匹配
  (electric-pair-mode 1)                               ;; 括号补全
  (add-hook 'prog-mode-hook 'prettify-symbols-mode)    ;; 会将 lambda 等符号美化为 λ
  (set-face-attribute 'default nil :font "Sarasa Term SC Nerd 12")
  (setq make-backup-files nil)                         ;; 关闭自动备份
  (delete-selection-mode 1)                            ;; 全选加强
  (setq ring-bell-function 'ignore)                    ;; 关掉哔哔声
  (fset 'yes-or-no-p 'y-or-n-p)                        ;; 快速 yes 或 no
  (setq-default indent-tabs-mode nil)                  ;; 启用 tab 键
  (setq-default tab-width 4)                           ;; 设置 tab 宽度
  (minibuffer-electric-default-mode 1)                 ;; minibuffer 增强功能
#+end_src
* 插件源配置
#+begin_src emacs-lisp  ;; 插件清华源配置
  (use-package package
    :config
    (add-to-list 'package-archives
                 '("melpa" ."https://melpa.org/packages/"))
    (unless (bound-and-true-p package--initialized)
      (package-initialize)))
#+end_src
* 快捷键提示
#+begin_src emacs-lisp
  (use-package which-key
    :init
    (define-key global-map (kbd "<f2>") '("打开 Eshell" . toggle-eshell))
    (define-key global-map (kbd "<f3>") '("打开配置文件" . open-file-config))
    :config (which-key-mode 1))

  (which-key-add-key-based-replacements
    "C-x 0" "关闭当前窗口"
    "C-x 1" "关闭其他窗口"
    "C-x 2" "底部分屏"
    "C-x 3" "右侧分屏"
    "C-x =" "光标位置字符信息"
    "C-x u" "撤销一次更改"
    "C-x C-c" "退出"
    "C-x C-f" "查找文件"
    "C-x C-o" "删除光标上下空白行"
    "C-x C-s" "保存文件"
    "C-h a" "按关键词搜索命令"
    "C-h b" "显示所有按键绑定"
    "C-h c" "快速显示快捷键功能"
    "C-h C" "描述编码系统"
    "C-h d" "按关键词搜索所有"
    "C-h e" "显示缓冲区"
    "C-h f" "查询 elisp 函数文档"
    "C-h F" "打开指定命令文档"
    "C-h g" "打开 GUN 项目网页"
    "C-h h" "打开 hello 页面"
    "C-h i" "打开 info 手册"
    "C-h I" "输入法文档"
    "C-h k" "快捷键描述"
    "C-h K" "按快捷键搜索文档"
    "C-h l" "最近 300 次按键使用"
    "C-h L" "显示语言环境相关"
    "C-h m" "当前 mode 的描述文档"
    "C-h n" "最近 emacs 更改新闻"
    "C-h o" "光标下的 elisp 函数文档"
    "C-h p" "搜索已安装的内置包"
    "C-h P" "显示可安装的插件"
    "C-h q" "帮助退出"
    "C-h r" "打开 emacs 手册"
    "C-h R" "打开 info 手册"
    "C-h s" "当前缓冲区的语法表"
    "C-h S" "显示编程语言符号文档"
    "C-h t" "emacs 快速指南"
    "C-h v" "elisp 变量文档"
    "C-h w" "查找命令绑定的快捷键"
    "C-h x" "显示指定命令的文档"
    "C-h ." "光标位置局部帮助信息"
    "C-h ?" "帮助命令菜单"
    "C-h <f1>" "帮助命令菜单"
    "C-h C-f" "打开 Emacs FAQ"
    "C-h C-h" "帮助命令菜单"
    "C-h C-q" "常用命令及其按键绑定"
    "M-g TAB" "跳转指定列"
    "M-g c" "跳转指定字符数"
    "M-g g" "跳转指定行"
    "M-g M-g" "跳转指定行")
#+end_src
* 启动面板
#+begin_src emacs-lisp
  (use-package dashboard
    :ensure t
    :config
    (dashboard-setup-startup-hook)
    :init
    (setq dashboard-banner-logo-title "你若安好，便是晴天")
    (setq dashboard-init-info "中国科学院大学沈阳计算技术研究所")
    (setq dashboard-footer-messages '("落霞与孤鹜齐飞 秋水共长天一色"))
    (setq dashboard-startup-banner 'official)
    (setq dashboard-display-icons-p t)
    (setq dashboard-icon-type 'nerd-icons)
    (setq dashboard-set-heading-icons t)
    (setq dashboard-set-file-icons t)
    (setq dashboard-set-navigator t)
    (setq dashboard-items '((recents . 10))))
#+end_src
* org 配置
#+begin_src emacs-lisp
  (use-package org-appear
    :ensure t
    :hook (org-mode . org-appear-mode)
    :config
    (setq org-appear-autostart t)
    (setq org-appear-autoemphasis t)
    (setq org-appear-autolinks t)
    (setq org-appear-autoentities t)
    (setq org-appear-autokeywords t)
    (setq org-appear-autosubmarkers t))
  (use-package org-fragtog
    :ensure t
    :hook (org-mode . org-fragtog-mode))
  (use-package org-superstar
    :ensure t
    :after org
    :hook (org-mode . org-superstar-mode))
  (use-package valign
    :ensure t
    :config
    (setq valign-fancy-bar t)
    (setq org-startup-align-all-tables t)
    :hook (org-mode . valign-mode))

  (org-babel-do-load-languages          ; org 中快速运行代码
   'org-babel-load-languages
   '((python . t)
     (C . t)))
  (setq org-startup-with-latex-preview t)
  (setq org-startup-numerated t)        ; 在 org 标题中添加序号
  (setq org-hide-emphasis-markers t)    ; 自动隐藏标记符号
#+end_src
* git 配置
#+begin_src emacs-lisp
  (use-package magit
  :ensure t)
#+end_src
* 文件配置
#+begin_src emacs-lisp
  (use-package recentf
    :init (recentf-mode 1)
    :config
    (global-set-key (kbd "C-x C-b") 'recentf-open-files)
    (setq recentf-max-menu-item 10))
#+end_src
* eshell 配置
#+begin_src emacs-lisp
  (use-package esh-autosuggest
    :hook (eshell-mode . esh-autosuggest-mode)
    :ensure t)
  (use-package eshell-syntax-highlighting
    :ensure t
    :config
    (setq eshell-banner-message "")
    (setq eshell-syntax-highlighting-highlight-in-remote-dirs t)
    (eshell-syntax-highlighting-global-mode +1))

  (defun toggle-eshell()
    (interactive)
    (if (get-buffer-window "*eshell*")                 ; 如果 eshell 窗口已打开，则完全退出
        (let ((buf (get-buffer "*eshell*")))
          (when (get-buffer-process buf)               ; 如果 eshell 有进程，则杀死
            (eshell-kill-process))
          (kill-buffer buf)                            ; 杀死缓冲区
          (delete-window (get-buffer-window buf)))     ; 关闭窗口
      (let ((win (split-window-below 30)))             ; 否则，新建 eshell
        (select-window win)
        (eshell))))

  ;;(define-key global-map (kbd "<f2>") '("打开 Eshell" . toggle-eshell))
#+end_src
* 自定义功能
#+begin_src emacs-lisp
  (defun ascii()
    "展示ascii码表"
    (interactive)
    (switch-to-buffer "*ASCII*")
    (erase-buffer)
    (setq buffer-read-only nil)        ;; Not need to edit the content, just read mode (added)
    (local-set-key "q" 'bury-buffer)   ;; Nice to have the option to bury the buffer (added)
    (setq lower32 '("nul" "soh" "stx" "etx" "eot" "enq" "ack" "bel"
  		          "bs" "ht" "nl" "vt" "np" "cr" "so" "si"
  		          "dle" "dc1" "dc2" "dc3" "dc4" "nak" "syn" "etb"
  		          "can" "em" "sub" "esc" "fs" "gs" "rs" "us"
  		          ))
    (save-excursion (let ((i -1))
                      (insert "ASCII characters 0 thru 127.\n\n")
                      (insert " 十六进制  十进制  字符 |  十六进制  十进制  字符 |  十六进制  十进制  字符 | 十六进制  十进制  字符\n")
                      (while (< i 31)
                        (insert (format " %4x      %4d    %4s | %4x      %4d    %4s | %4x      %4d    %4s | %4x      %4d    %4s \n"
                                        (setq i (+ 1  i)) i (elt lower32 i)
                                        (setq i (+ 32 i)) i (single-key-description i)
                                        (setq i (+ 32 i)) i (single-key-description i)
                                        (setq i (+ 32 i)) i (single-key-description i)))
                        (setq i (- i 96))))))

  (defun nasm-compile()
    "自动使用 make 编译汇编"
    (interactive)
    (unless (file-exists-p "Makefile")
      (error "No Makefile found in current directory"))
    (compile "make bochs"))

  (defun open-file-config()
    "打开配置文件"
    (interactive)
    (let ((buffer (buffer-name)))
      (if (string= buffer "emacs.org")
          (switch-to-buffer (other-buffer))
        (find-file "~/.emacs.d/emacs.org"))))
#+end_src

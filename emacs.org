#+title:   elisp é…ç½®æ–‡ä»¶
#+author:  JanSky
#+date:    2025-07-10
#+STARTUP: overview indent


* åŸºç¡€é…ç½®
#+begin_src emacs-lisp
  (setq inhibit-startup-screen t)                                     ;; å…³é—­å¼€å§‹ç•Œé¢
  (global-display-line-numbers-mode 1)                                ;; æ˜¾ç¤ºè¡Œå·
  (setq display-line-numbers-width-start t)                           ;; åŠ¨æ€è°ƒæ•´è¡Œå·å®½åº¦
  (setq display-line-numbers-grow-only t)                             ;; è¡Œå·å®½åº¦åªå¢ä¸å‡ï¼ˆå‡å°‘æŠ–åŠ¨ï¼‰
  (tool-bar-mode -1)                                                  ;; å…³é—­å·¥å…·æ 
  (menu-bar-mode -1)                                                  ;; å…³é—­èœå•æ 
  (setq-default cursor-type 'bar)                                     ;; æ›´æ”¹å…‰æ ‡æ ·å¼
  (global-hl-line-mode t)                                             ;; é«˜äº®å½“å‰è¡Œ
  (scroll-bar-mode -1)                                                ;; å…³é—­æ–‡ä»¶æ»‘åŠ¨æ§ä»¶
  (show-paren-mode t)                                                 ;; æ‹¬å·åŒ¹é…
  (electric-pair-mode 1)                                              ;; æ‹¬å·è¡¥å…¨
  (add-hook 'prog-mode-hook 'prettify-symbols-mode)                   ;; ä¼šå°† lambda ç­‰ç¬¦å·ç¾åŒ–ä¸º Î»
  (set-face-attribute 'default nil :font "Sarasa Term SC Nerd 12")    ;; è®¾ç½®å­—ä½“
  (setq make-backup-files nil)                                        ;; å…³é—­è‡ªåŠ¨å¤‡ä»½
  (delete-selection-mode 1)                                           ;; å…¨é€‰åŠ å¼º
  (setq ring-bell-function 'ignore)                                   ;; å…³æ‰å“”å“”å£°
  (fset 'yes-or-no-p 'y-or-n-p)                                       ;; å¿«é€Ÿ yes æˆ– no
  (setq-default indent-tabs-mode nil)                                 ;; å¯ç”¨ tab é”®
  (setq default-frame-alist '((width . 130) (height . 40)))           ;; è®¾ç½®çª—å£å¤§å°
  (setq-default truncate-lines t)                                     ;; ç¦ç”¨å•è¡Œè¿‡é•¿æ—¶è‡ªåŠ¨æ¢è¡Œ
#+end_src

* æ’ä»¶æºé…ç½®
#+begin_src emacs-lisp
  (use-package package
    :config
    (setq package-archives '(("melpa" . "https://melpa.org/packages/")))
    (setq package-check-signature nil)
    (package-initialize))
#+end_src

* modelineé…ç½®
#+begin_src emacs-lisp
  (size-indication-mode t)                                            ;; æ˜¾ç¤ºæ–‡ä»¶å¤§å°
  (line-number-mode -1)                                               ;; å…³é—­è¡Œå·æ˜¾ç¤º
  (column-number-mode t)                                              ;; æ˜¾ç¤ºå½“å‰åˆ—
  (setq column-number-indicator-zero-based nil)                       ;; åˆ—ä» 1 å¼€å§‹è®¡æ•°
  (setq display-time-format "ğŸ“†%Yå¹´%mæœˆ%dæ—¥ â°%H:%M")                ;; æ—¥æœŸæ ¼å¼
  (setq display-time-default-load-average nil)                        ;; ä¸ç°å®è´Ÿè½½
  (setq battery-mode-line-format "ğŸ”‹%p%% âš¡%rç“¦")                    ;; ç”µæ± æ ¼å¼
  (setq battery-update-interval 1)                                    ;; ç”µæ± æ›´æ–°å¹³ç‡ä¸º 1 ç§’
  (display-time-mode 1)                                               ;; æ˜¾ç¤ºæ—¶é—´
  (display-battery-mode 1)                                            ;; æ˜¾ç¤ºç”µæ± 
#+end_src

* minibuffer é…ç½®
#+begin_src emacs-lisp
  (minibuffer-electric-default-mode 1)                                ;; minibuffer å¢å¼ºåŠŸèƒ½
  (fido-vertical-mode 1)                                         ;; å‚ç›´è¡¥å…¨
  (setq completion-auto-help nil)                                     ;; æŒ‰ TAB ä¸æ˜¾ç¤ºè¡¥å…¨åˆ—è¡¨ç¼“å†²åŒº
#+end_src

* ä¸»é¢˜é…ç½®
** åŸºç¡€é…è‰²
#+begin_src emacs-lisp
  (use-package catppuccin-theme
    :ensure t
    :config
    (setq catppuccin-flavor 'mocha)
    (load-theme 'catppuccin t))
#+end_src
** å½©è™¹æ‹¬å·
#+begin_src elisp
  (use-package rainbow-delimiters
    :ensure t
    :hook (prog-mode . rainbow-delimiters-mode))
#+end_src

* tree-sitter é…ç½®
** åŸºç¡€é…ç½®
#+begin_src emacs-lisp
  (use-package treesit
    :config
    (setq treesit-language-source-alist
          '((c . ("https://github.com/tree-sitter/tree-sitter-c"))
            (cpp . ("https://github.com/tree-sitter/tree-sitter-cpp"))
            (toml . ("https://github.com/tree-sitter/tree-sitter-toml"))
            (hyprlang . ("https://github.com/tree-sitter-grammars/tree-sitter-hyprlang"))))
    (setq major-mode-remap-alist
          '((c-mode . c-ts-mode)
            (c++-mode . c++-ts-mode)
            (toml-mode . toml-ts-mode)))
    (setq treesit-font-lock-level 4))


#+end_src
** hyprland é«˜äº®
#+begin_src emacs-lisp
  (defcustom hyprlang-ts-mode-indent-offset 4
    "åœ¨ hyprlang-ts-mode ä¸­è®¾ç½®ä»£ç ç¼©è¿›."
    :type 'integer
    :safe 'integerp
    :group 'hyprlang)

  (defvar hyprlang-ts-mode--font-lock-rules
    (treesit-font-lock-rules
     :language 'hyprlang
     :feature 'comment    ;; é…ç½®ä»£ç æ³¨é‡Š
     `((comment) @font-lock-comment-face)

     :language 'hyprlang
     :feature 'special    ;; é…ç½®ç‰¹æ®Šå…³é”®å­—
     `([ "source" "exec" "exec-once" ] @font-lock-keyword-face)

     :language 'hyprlang
     :feature 'keyword    ;; é…ç½®ä¸­çš„ bind workspace monitor ç­‰
     `((keyword (name) @font-lock-keyword-face))

     :language 'hyprlang
     :feature 'assignment    ;; åŒ¹é…èµ‹å€¼è¯­å¥ä¸­çš„å˜é‡åéƒ¨åˆ†
     `((assignment (name) @font-lock-property-use-face))

     :language 'hyprlang
     :override t          ;; ä¼˜å…ˆçº§æ›´é«˜
     :feature 'section    ;; åŒ¹é…èŠ‚åï¼Œå¦‚ general {, bind { ä¸­çš„ general, bind
     `((section (name) @font-lock-type-face))

     :language 'hyprlang
     :override t
     :feature 'section-device    ;; ç‰¹æ®Šçš„è®¾å¤‡èŠ‚ï¼Œå¦‚ device:name {
     `((section device: (device_name) @font-lock-type-face))

     :language 'hyprlang
     :feature 'variable    ;; åŒ¹é…å˜é‡å¼•ç”¨ï¼Œå¦‚ $mainMod
     `((variable) @font-lock-variable-name-face)

     :language 'hyprlang
     :feature 'dollar    ;; åŒ¹é…å˜é‡å‰ç¼€ $
     `("$" @font-lock-punctuation-face)

     :language 'hyprlang
     :feature 'boolean    ;; åŒ¹é…å¸ƒå°”å€¼
     `((boolean) @font-lock-number-face)

     :language 'hyprlang
     :feature 'mod    ;; åŒ¹é…ä¿®é¥°é”®ï¼Œå¦‚ SUPER, SHIFT, CTRL
     `((mod) @font-lock-constant-face)

     :language 'hyprlang
     :feature 'builtin    ;; åŒ¹é…é¢œè‰²å‡½æ•° rgb(), rgba()
     `([ "rgb" "rgba" ] @font-lock-builtin-face)

     :language 'hyprlang
     :feature 'number    ;; åŒ¹é…å¤šç§æ•°å­—ç±»å‹
     `([ (number) (legacy_hex) (angle) (hex) (display) (position) ] @font-lock-number-face)

     :language 'hyprlang
     :feature 'deg    ;; åŒ¹é…è§’åº¦å•ä½ deg
     `("deg" @font-lock-type-face)

     :language 'hyprlang
     :feature 'delimit    ;; åŒ¹é…é€—å·å’Œå†’å·
     `([ "," ":" ] @font-lock-delimiter-face)

     :language 'hyprlang
     :feature 'bracket    ;; åŒ¹é…åœ†æ‹¬å·å’ŒèŠ±æ‹¬å·
     `([ "(" ")" "{" "}" ] @font-lock-bracket-face)

     :language 'hyprlang
     :feature 'operator    ;; åŒ¹é…èµ‹å€¼å’Œç®—æœ¯è¿ç®—ç¬¦
     `([ "=" "-" "+" ] @font-lock-operator-face)

     :language 'hyprlang
     :feature 'string    ;; åŒ¹é…å­—ç¬¦ä¸²å’Œå­—ç¬¦ä¸²å­—é¢é‡
     `([ (string) (string_literal) ] @font-lock-string-face)))

  (defvar hyprlang-ts-mode--indent-rules    ;; hyprlang-ts-mode çš„ç¼©è¿›è§„åˆ™å®šä¹‰
    `((hyprlang
       ((node-is "}") parent-bol 0)
       ((parent-is "configuration") column-0 0)
       ((parent-is "section") parent-bol hyprlang-ts-mode-indent-offset))))

  (defvar hyprlang-ts-mode--syntax-table    ;; åˆ›å»ºè¯­æ³•è¡¨
    (let ((syntax-table (make-syntax-table)))
      (modify-syntax-entry ?# "<" syntax-table)
      (modify-syntax-entry ?\n ">#" syntax-table)
      syntax-table)
    "Syntax table for `hyprlang-ts-mode'.")

  (defun hyprlang-ts-mode--defun-name (node)
    "å‡½æ•°åå°±æ˜¯ section çš„åç§°"
    (if (string-equal-ignore-case (treesit-node-type node) "section")
        (treesit-node-text (treesit-node-child node 0) t)
      nil))

  (defun hyprlang-ts-setup ()
    "ä¸ºå½“å‰ç¼“å†²åŒºåˆ›å»ºä¸€ä¸ª hyprlang è¯­è¨€çš„ Tree-sitter è§£æå™¨"
    (treesit-parser-create 'hyprlang)
    ;; comment starts with # and it doesn't need and end symbol
    (setq-local comment-start "#")
    (setq-local comment-end "")
    (setq-local treesit-defun-name-function #'hyprlang-ts-mode--defun-name)

    ;; Navigation
    (setq-local treesit-defun-type-regexp "section")

    ;; Imenu
    (setq-local treesit-simple-imenu-settings
                '(("Section" "\\`section\\'" nil nil)))

    ;; set font lock
    (setq-local treesit-font-lock-settings hyprlang-ts-mode--font-lock-rules)
    (setq-local treesit-font-lock-feature-list
                '((comment special deg delimit dollar bracket)
                  (section section-device assignment keyword declaration)
                  (builtin operator variable string number boolean mod)))

    ;; set indentation rules
    (setq-local treesit-simple-indent-rules hyprlang-ts-mode--indent-rules)
    (treesit-major-mode-setup))

  (define-derived-mode hyprlang-ts-mode prog-mode "Hyprlang"
    "A mode for editing Hyprland configuration file."
    :group 'hyprlang
    :syntax-table hyprlang-ts-mode--syntax-table

    (unless (treesit-ready-p 'hyprlang)
      ;; add the language grammer
      (if (and (treesit-available-p) (boundp 'treesit-language-source-alist))
          (add-to-list 'treesit-language-source-alist
                       '(hyprlang "https://github.com/tree-sitter-grammars/tree-sitter-hyprlang" "master")))
      (error "Tree-sitter for hyprlang isn't available.
  You can install it with `treesit-install-language-grammar'"))

    (hyprlang-ts-setup))

  (if (treesit-ready-p 'hyprlang)
      (add-to-list 'auto-mode-alist '("/hypr/.*\\.conf\\'" . hyprlang-ts-mode)))
#+end_src

* lsp é…ç½®
** åŸºç¡€é…ç½®
#+begin_src emacs-lisp
  (use-package eglot
    :config
    (add-to-list 'eglot-server-programs '((c++-ts-mode c-ts-mode) "clangd"))
    :hook
    (c++-ts-mode . eglot-ensure)
    (c-ts-mode . eglot-ensure))
#+end_src
** è¡¥å…¨è®¾ç½®
#+begin_src elisp

#+end_src

* org é…ç½®
** åŸºç¡€é…ç½®
#+begin_src emacs-lisp
  (org-babel-do-load-languages          ; org ä¸­å¿«é€Ÿè¿è¡Œä»£ç 
   'org-babel-load-languages
   '((python . t)
     (C . t)))
  (setq org-startup-with-latex-preview t)
  (setq org-startup-numerated t)        ; åœ¨ org æ ‡é¢˜ä¸­æ·»åŠ åºå·
  (setq org-hide-emphasis-markers t)    ; è‡ªåŠ¨éšè—æ ‡è®°ç¬¦å·
#+end_src
** ç¼–è¾‘ä¸å¯è§éƒ¨åˆ†
#+begin_src elisp
  (use-package org-appear
    :ensure t
    :hook (org-mode . org-appear-mode)
    :config
    (setq org-appear-autostart t)
    (setq org-appear-autoemphasis t)
    (setq org-appear-autolinks t)
    (setq org-appear-autoentities t)
    (setq org-appear-autokeywords t)
    (setq org-appear-autosubmarkers t))
#+end_src

* æ–‡ä»¶é…ç½®
#+begin_src emacs-lisp
  (use-package recentf
    :init (recentf-mode 1)
    :config
    (global-set-key (kbd "C-x C-b") 'recentf-open-files)
    (setq recentf-max-menu-item 10))
#+end_src

* eshell é…ç½®
** åŸºç¡€é…ç½®
#+begin_src emacs-lisp
  (setq eshell-banner-message "")                      ;; å–æ¶ˆ eshell å¯åŠ¨é—®å€™

  (add-hook 'eshell-mode-hook
            (lambda ()
              (shell-command "fcitx5-remote -c")       ;; å…³é—­è¾“å…¥æ³•
              (display-line-numbers-mode -1)))         ;; ä¸æ˜¾ç¤ºè¡Œå·

  (defun toggle-eshell()
    (interactive)
    (if (get-buffer-window "*eshell*")                   ;; æ£€æŸ¥æ˜¯å¦å­˜åœ¨æ˜¾ç¤º *eshell* ç¼“å†²åŒºçš„çª—å£
        (let ((buf (get-buffer "*eshell*")))             ;; ä¸ºå˜é‡ buf ç»‘å®š *eshell*
          (kill-buffer buf)                              ;; æ€æ­»ç¼“å†²åŒº
          (delete-window (get-buffer-window buf)))       ;; å…³é—­çª—å£
      (let ((win (split-window-below 32)))               ;; å¦åˆ™ï¼Œåœ¨åº•éƒ¨æ–°å»ºä¸€ä¸ªçª—å£,é«˜åº¦è‡ªå®šä¹‰
        (select-window win)                              ;; ç„¦ç‚¹åˆ‡æ¢åˆ°è¿™ä¸ªçª—å£
        (eshell))))                                      ;; è¿è¡Œ eshell

  (defun my-eshell-prompt ()
    "æ·±è‰²ä¸»é¢˜æœ€ä½³å¯è¯»æ€§æç¤ºç¬¦"
    (concat
     (propertize "ğŸ¦Š " 'face '(:foreground "#FF6B35"))                     ;; å›¾æ ‡ - äº®æ©™è‰²
     (propertize (user-login-name) 'face '(:foreground "#4ECDC4"))        ;; ç”¨æˆ·å - é’è‰²
     (propertize "@" 'face '(:foreground "#A0A0A0"))                      ;; åˆ†éš”ç¬¦ - æµ…ç°è‰²
     (propertize (file-name-nondirectory (eshell/pwd))                    ;; ç›®å½•å - äº®ç»¿è‰²
                 'face '(:foreground "#98CE00" :bold t :weight 'bold))
     (propertize " > " 'face '(:foreground "#FFD166"))))                  ;; ç»“å°¾ç¬¦å· - äº®é»„è‰²
  (setq eshell-prompt-function 'my-eshell-prompt)
  #+end_src

** eshell å¿«é€Ÿè¿è¡Œä»£ç 
#+begin_src emacs-lisp
  (defun esh-coderun ()
    "å¿«é€Ÿæ‰§è¡Œä»£ç "
    (interactive)
    (let* ((file (buffer-name))       ;; è·å–æ–‡ä»¶å
           (main (file-name-base))    ;; è·å–ä¸å¸¦æ‰©å±•åçš„æ–‡ä»¶å
           (cmd (format "clang %s -o %s" file main)))    ;; è®¾å®šå¥½éœ€è¦æ‰§è¡Œçš„å‘½ä»¤
      (toggle-eshell)                 ;; æ‰“å¼€ eshell
      (insert cmd)                    ;; æ’å…¥å‘½ä»¤
      (eshell-send-input)))           ;; æ‰§è¡Œå‘½ä»¤
#+end_src

* é‚®ä»¶é…ç½®
#+begin_src elisp
  (require 'auth-source)
  (setq auth-sources '("~/.authinfo" "~/.authinfo.gpg"))    ;; æˆæƒç 
  (setq message-send-mail-function 'smtpmail-send-it)       ;; å‘é€é‚®ä»¶ä½¿ç”¨çš„å‡½æ•°
  (setq user-mail-address "1102812928@qq.com")              ;; è®¾ç½®é‚®ç®±åœ°å€
  (setq user-full-name "JanSky")                            ;; è®¾ç½®é‚®ç®±ç”¨æˆ·å
  (setq smtpmail-smtp-user "1102812928@qq.com"              ;; è®¾ç½®é‚®ç®±ç”¨æˆ·
        smtpmail-smtp-server "smtp.qq.com"                  ;; è®¾ç½®æœåŠ¡
        smtpmail-smtp-service 465                           ;; è®¾ç½®ç«¯å£
        smtpmail-stream-type 'ssl)                          ;; è®¾ç½®å®‰å…¨æœåŠ¡
  (setq smtpmail-debug-info t)                              ;; åŸºç¡€è°ƒè¯•ä¿¡æ¯
  (setq smtpmail-debug-verb t)                              ;; è¯¦ç»†è°ƒè¯•ä¿¡æ¯
  (setq message-kill-buffer-on-exit t)                      ;; å‘é€ååˆ é™¤ç¼“å†²åŒº
  (setq message-signature "ä½ è¯ºå®‰å¥½ï¼Œä¾¿æ˜¯æ™´å¤©")             ;; è‡ªå¸¦æ·»åŠ ç­¾å

  (setq gnus-select-method
        '(nnimap "qq"
                 (nnimap-address "imap.qq.com")
                 (nnimap-server-port 993)
                 (nnimap-stream ssl)
                 (nnimap-authinfo-file "~/.authinfo")))
#+end_src

* æ‚é¡¹åŠŸèƒ½
** ASCII ç è¡¨å±•ç¤º
#+begin_src emacs-lisp
  (defun ascii()
    "å±•ç¤ºasciiç è¡¨"
    (interactive)
    (switch-to-buffer "*ASCII*")
    (erase-buffer)
    (setq buffer-read-only nil)        ;; Not need to edit the content, just read mode (added)
    (local-set-key "q" 'bury-buffer)   ;; Nice to have the option to bury the buffer (added)
    (setq lower32 '("nul" "soh" "stx" "etx" "eot" "enq" "ack" "bel"
  		          "bs" "ht" "nl" "vt" "np" "cr" "so" "si"
  		          "dle" "dc1" "dc2" "dc3" "dc4" "nak" "syn" "etb"
  		          "can" "em" "sub" "esc" "fs" "gs" "rs" "us"))
    (save-excursion (let ((i -1))
                      (insert "ASCII characters 0 thru 127.\n\n")
                      (insert " åå…­è¿›åˆ¶  åè¿›åˆ¶  å­—ç¬¦ |  åå…­è¿›åˆ¶  åè¿›åˆ¶  å­—ç¬¦ |  åå…­è¿›åˆ¶  åè¿›åˆ¶  å­—ç¬¦ | åå…­è¿›åˆ¶  åè¿›åˆ¶  å­—ç¬¦\n")
                      (while (< i 31)
                        (insert (format " %4x      %4d    %4s | %4x      %4d    %4s  | %4x      %4d    %4s  |  %4x     %4d  %4s \n"
                                        (setq i (+ 1  i)) i (elt lower32 i)
                                        (setq i (+ 32 i)) i (single-key-description i)
                                        (setq i (+ 32 i)) i (single-key-description i)
                                        (setq i (+ 32 i)) i (single-key-description i)))
                        (setq i (- i 96))))))
#+end_src

** å¿«é€Ÿæ‰“å¼€é…ç½®æ–‡ä»¶
#+begin_src emacs-lisp
  (defun open-file-config()
    "æ‰“å¼€é…ç½®æ–‡ä»¶"
    (interactive)
    (let ((buffer (buffer-name)))
      (if (string= buffer "emacs.org")
          (kill-buffer buffer)
        (find-file "~/.emacs.d/emacs.org"))))
#+end_src

** ç½‘ç»œè°ƒè¯•åŠ©æ‰‹
#+begin_src elisp
  (defvar server-process nil
    "ä¿å­˜æœåŠ¡å™¨è¿›ç¨‹çš„å˜é‡")

  (defun server-filter (process string)
    "å¤„ç†æ¶ˆæ¯"
    (message "æ”¶åˆ°æ¶ˆæ¯: %s" string)
    (process-send-string process (format "æœåŠ¡å™¨æ”¶åˆ°")))

  (defun server-sentinel (process event)
    "å¤„ç†è¿æ¥çŠ¶æ€å˜åŒ–"
    (message "è¿æ¥çŠ¶æ€: %s %s" (process-name process) event))

  (defun tcp-server ()
    "åœ¨æŒ‡å®šç«¯å£å¯åŠ¨ TCP æœåŠ¡å™¨"
    (interactive )
    (if (null server-process)
        (progn
          (setq server-process
                (make-network-process
                 :name "tcp-server"                 ;; è¿›ç¨‹çš„åå­—
                 :service 8080                      ;; ç«¯å£å·
                 :host "127.0.0.1"                  ;; ip åœ°å€
                 :server t                          ;; åˆ›å»ºæœåŠ¡å™¨è¿›ç¨‹
                 :family 'ipv4                      ;; æ˜¯ç”¨ ipv4
                 :noquery t                         ;; Emacs é€€å‡ºæ—¶è‡ªåŠ¨ç»ˆæ­¢è¿›ç¨‹
                 :filter 'server-filter             ;; å¤„ç†æ¶ˆæ¯
                 :sentinel 'server-sentinel))       ;; å¤„ç†è¿æ¥çŠ¶æ€
                (message "TCP æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ %d" 8080))
      (progn (delete-process server-process)
             (setq server-process nil)
             (message "TCP æœåŠ¡å™¨å·²åœæ­¢"))))

  (defun udp-server ()
    "åœ¨æŒ‡å®šç«¯å£å¯åŠ¨ UDP æœåŠ¡å™¨"
    (interactive )
    (if (null server-process)
        (progn
          (setq server-process
                (make-network-process
                 :name "udp-server"                 ;; è¿›ç¨‹çš„åå­—
                 :service 8080                      ;; ç«¯å£å·
                 :host "127.0.0.1"                  ;; ip åœ°å€
                 :server t                          ;; åˆ›å»ºæœåŠ¡å™¨è¿›ç¨‹
                 :family 'ipv4                      ;; æ˜¯ç”¨ ipv4
                 :type 'datagram                    ;; UDP åè®®
                 :noquery t                         ;; Emacs é€€å‡ºæ—¶è‡ªåŠ¨ç»ˆæ­¢è¿›ç¨‹
                 :filter 'server-filter             ;; å¤„ç†æ¶ˆæ¯
                 :sentinel 'server-sentinel))       ;; å¤„ç†è¿æ¥çŠ¶æ€
                (message "UDP æœåŠ¡å™¨å·²å¯åŠ¨åœ¨ç«¯å£ %d" 8080))
      (progn (delete-process server-process)
             (setq server-process nil)
             (message "UDP æœåŠ¡å™¨å·²åœæ­¢"))))
#+end_src
** å…³é—­å½“å‰ç¼“å†²åŒº
#+begin_src elisp
  (defun kill-current-buffer ()
    "å…³é—­å½“å‰ç¼“å†²åŒº"
    (interactive)
    (kill-buffer (current-buffer)))
#+end_src

* å¿«æ·é”®æç¤º
** åŸºç¡€è®¾ç½®
#+begin_src emacs-lisp
  (use-package which-key
    :init
    (define-key global-map (kbd "<f2>") '("æ‰“å¼€ Eshell" . toggle-eshell))
    (define-key global-map (kbd "<f3>") '("æ‰“å¼€é…ç½®æ–‡ä»¶" . open-file-config))
    (define-key global-map (kbd "<f5>") '("å¿«é€Ÿè¿è¡Œä»£ç " . esh-coderun))
    (define-key global-map (kbd "C-x c") '("å…³é—­å½“å‰ç¼“å†²åŒº" . kill-current-buffer))
    :config (which-key-mode 1))
#+end_src
** æ™®é€šæ¨¡å¼å¿«æ·é”®
#+begin_src elisp
  (which-key-add-key-based-replacements
    "C-x 0" "å…³é—­å½“å‰çª—å£"
    "C-x 1" "å…³é—­å…¶ä»–çª—å£"
    "C-x 2" "åº•éƒ¨åˆ†å±"
    "C-x 3" "å³ä¾§åˆ†å±"
    "C-x 4 m" "å³ä¾§æ’°å†™é‚®ä»¶"
    "C-x 5 m" "æ–°å»ºçª—å£æ’°å†™é‚®ä»¶"
    "C-x =" "å…‰æ ‡ä½ç½®å­—ç¬¦ä¿¡æ¯"
    "C-x m" "æ’°å†™é‚®ä»¶"
    "C-x u" "æ’¤é”€ä¸€æ¬¡æ›´æ”¹"
    "C-x z" "é‡å¤ä¸Šæ¬¡æ‰§è¡Œçš„å‘½ä»¤"
    "C-x C-c" "é€€å‡º"
    "C-x C-f" "æŸ¥æ‰¾æ–‡ä»¶"
    "C-x C-n" "å®šä½ç›®æ ‡åˆ—"
    "C-x C-o" "åˆ é™¤å…‰æ ‡ä¸Šä¸‹ç©ºç™½è¡Œ"
    "C-x C-s" "ä¿å­˜æ–‡ä»¶")

  (which-key-add-key-based-replacements
    "C-h 4 s" "è·³è½¬å®šä¹‰"
    "C-h RET" "æŸ¥çœ‹è®¢è´­ä¿¡æ¯"
    "C-h a" "æŒ‰å…³é”®è¯æœç´¢å‘½ä»¤"
    "C-h b" "æ˜¾ç¤ºæ‰€æœ‰æŒ‰é”®ç»‘å®š"
    "C-h c" "å¿«é€Ÿæ˜¾ç¤ºå¿«æ·é”®åŠŸèƒ½"
    "C-h C" "æè¿°ç¼–ç ç³»ç»Ÿ"
    "C-h d" "æŒ‰å…³é”®è¯æœç´¢æ‰€æœ‰"
    "C-h e" "æ˜¾ç¤ºç¼“å†²åŒº"
    "C-h f" "æŸ¥è¯¢ elisp å‡½æ•°æ–‡æ¡£"
    "C-h F" "æ‰“å¼€æŒ‡å®šå‘½ä»¤æ–‡æ¡£"
    "C-h g" "æ‰“å¼€ GUN é¡¹ç›®ç½‘é¡µ"
    "C-h h" "æ‰“å¼€ hello é¡µé¢"
    "C-h i" "æ‰“å¼€ info æ‰‹å†Œ"
    "C-h I" "è¾“å…¥æ³•æ–‡æ¡£"
    "C-h k" "å¿«æ·é”®æè¿°"
    "C-h K" "æŒ‰å¿«æ·é”®æœç´¢æ–‡æ¡£"
    "C-h l" "æœ€è¿‘ 300 æ¬¡æŒ‰é”®ä½¿ç”¨"
    "C-h L" "æ˜¾ç¤ºè¯­è¨€ç¯å¢ƒç›¸å…³"
    "C-h m" "å½“å‰ mode çš„æè¿°æ–‡æ¡£"
    "C-h n" "æœ€è¿‘ emacs æ›´æ”¹æ–°é—»"
    "C-h o" "å…‰æ ‡ä¸‹çš„ elisp å‡½æ•°æ–‡æ¡£"
    "C-h p" "å…³é”®å­—æŸ¥è¯¢è½¯ä»¶åŒ…"
    "C-h P" "è½¯ä»¶åŒ…æè¿°"
    "C-h q" "å¸®åŠ©é€€å‡º"
    "C-h r" "æ‰“å¼€ emacs æ‰‹å†Œ"
    "C-h R" "æ‰“å¼€ info æ‰‹å†Œ"
    "C-h s" "å½“å‰ç¼“å†²åŒºçš„è¯­æ³•è¡¨"
    "C-h S" "æ˜¾ç¤ºç¼–ç¨‹è¯­è¨€ç¬¦å·æ–‡æ¡£"
    "C-h t" "emacs å¿«é€ŸæŒ‡å—"
    "C-h v" "elisp å˜é‡æ–‡æ¡£"
    "C-h w" "æŸ¥æ‰¾å‘½ä»¤ç»‘å®šçš„å¿«æ·é”®"
    "C-h x" "æ˜¾ç¤ºæŒ‡å®šå‘½ä»¤çš„æ–‡æ¡£"
    "C-h ." "å…‰æ ‡ä½ç½®å±€éƒ¨å¸®åŠ©ä¿¡æ¯"
    "C-h ?" "å¸®åŠ©å‘½ä»¤èœå•"
    "C-h C-\\" "æŸ¥çœ‹è¾“å…¥æ³•ä¿¡æ¯"
    "C-h <f1>" "å¸®åŠ©å‘½ä»¤èœå•"
    "C-h C-a" "æ‰“å¼€ Emacs å¼€å§‹ç•Œé¢"
    "C-h C-c" "æŸ¥çœ‹ Emacs å®Œæ•´è®¸å¯è¯"
    "C-h C-d" "æ˜¾ç¤º Emacs è°ƒè¯•å¸®åŠ©ä¿¡æ¯"
    "C-h C-e" "æ˜¾ç¤ºå¤–éƒ¨è½¯ä»¶åŒ…çš„ä¿¡æ¯"
    "C-h C-f" "æ‰“å¼€ Emacs FAQ"
    "C-h C-h" "å¸®åŠ©å‘½ä»¤èœå•"
    "C-h C-n" "æŸ¥çœ‹ Emacs æ›´æ–°æ–°é—»"
    "C-h C-o" "æŸ¥çœ‹ Emacs åˆ†å‘ä¿¡æ¯"
    "C-h C-p" "æŸ¥çœ‹ Emacs å·²çŸ¥é—®é¢˜"
    "C-h C-q" "å¸¸ç”¨å‘½ä»¤åŠå…¶æŒ‰é”®ç»‘å®š"
    "C-h C-t" "æŸ¥çœ‹ Emacs å¼€å‘è®¡åˆ’"
    "C-h C-w" "æŸ¥çœ‹ GNU Emacs å…è´£å£°æ˜")

  (which-key-add-key-based-replacements
    "M-g TAB" "è·³è½¬æŒ‡å®šåˆ—"
    "M-g c" "è·³è½¬æŒ‡å®šå­—ç¬¦æ•°"
    "M-g g" "è·³è½¬æŒ‡å®šè¡Œ"
    "M-g M-g" "è·³è½¬æŒ‡å®šè¡Œ")
#+end_src
** é‚®ä»¶æ¨¡å¼
#+begin_src elisp
  (which-key-add-major-mode-key-based-replacements 'message-mode
    "C-c C-a" "æ·»åŠ é™„ä»¶"
    "C-c C-b" "è·³è½¬åˆ°æ¶ˆæ¯æ­£æ–‡"
    "C-c C-c" "å‘é€é‚®ä»¶å¹¶é€€å‡º"
    "C-c C-f C-s" "ç§»åŠ¨åˆ°ä¸»é¢˜"
    "C-c C-f C-c" "ç§»åŠ¨åˆ° CC æ ‡é¢˜"
    "C-c C-f C-b" "ç§»åŠ¨åˆ° BCC å¤´éƒ¨"
    "C-c C-f C-r" "ç§»åŠ¨åˆ° Reply-To å¤´éƒ¨"
    "C-c C-f C-f" "ç§»åŠ¨åˆ° Mail-Followup-To å¤´éƒ¨å­—æ®µ"
    "C-c C-f C-w" "æ·»åŠ ä¸€ä¸ªæ–°çš„ FCC å¤´å­—æ®µ"
    "C-c C-w" "æ’å…¥è‡ªå®šä¹‰ç­¾å"
    "C-c C-s" "å‘é€é‚®ä»¶"
    "C-c C-q" "è‡ªåŠ¨æ¢è¡Œå¤„ç†å¼•ç”¨çš„é‚®ä»¶å†…å®¹"
    "C-c C-y" "é‚®ä»¶å›å¤æ—¶è‡ªåŠ¨å¼•ç”¨åŸæ–‡")
#+end_src
** org æ¨¡å¼å¿«æ·é”®
#+begin_src elisp
  (which-key-add-major-mode-key-based-replacements 'org-mode
    "C-c C-," "æ’å…¥ç»“æ„æ¨¡æ¿")
#+end_src
** C æ¨¡å¼
#+begin_src elisp
  (which-key-add-major-mode-key-based-replacements 'c-ts-mode
    "C-c ." "C è¯­è¨€ä»£ç é£æ ¼")
#+end_src
